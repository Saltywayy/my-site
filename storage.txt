// ========================================
// –ß–ê–°–¢–¨ 4: –°–û–•–†–ê–ù–ï–ù–ò–ï –ü–†–û–ì–†–ï–°–°–ê –ò –£–õ–£–ß–®–ï–ù–ò–Ø UX
// ========================================
// localStorage, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

// ===== 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è localStorage =====
const STORAGE_KEY = 'philosophyTest_answers';
const STORAGE_PROGRESS_KEY = 'philosophyTest_progress';
const STORAGE_TIMESTAMP_KEY = 'philosophyTest_timestamp';
const AUTO_SAVE_INTERVAL = 5000; // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
const EXPIRY_DAYS = 7; // –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è 7 –¥–Ω–µ–π

// ===== 2. –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –º–æ–¥–∞–ª–æ–≤ =====
const uxStyles = `
.notification {
  position: fixed;
  top: 100px;
  right: 20px;
  background: var(--card);
  color: var(--text);
  padding: 14px 20px;
  border-radius: 8px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
  z-index: 150;
  animation: slideInRight 0.3s ease-out;
  border-left: 4px solid var(--accent);
  max-width: 350px;
}
.notification.success { border-left-color: var(--success); }
.notification.warning { border-left-color: #ff9800; }
.notification.error { border-left-color: #f44336; }

@keyframes slideInRight {
  from { transform: translateX(400px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.confirm-modal {
  position: fixed;
  inset: 0;
  background: rgba(2,6,23,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 160;
  animation: fadeIn 0.2s;
}
.confirm-modal.show { display: flex; }

.confirm-content {
  background: var(--card);
  padding: 24px;
  border-radius: 12px;
  max-width: 450px;
  width: 90%;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}
.confirm-content h3 {
  margin: 0 0 12px 0;
  color: var(--text);
}
.confirm-content p {
  margin: 0 0 20px 0;
  color: var(--muted);
  line-height: 1.5;
}
.confirm-buttons {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.validation-error {
  color: #f44336;
  font-size: 13px;
  margin-top: 8px;
  display: none;
}
.validation-error.show { display: block; }

.resume-banner {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: white;
  padding: 16px;
  border-radius: 10px;
  margin-bottom: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.resume-banner .message {
  flex: 1;
  font-weight: 600;
}
.resume-banner .actions {
  display: flex;
  gap: 8px;
}
.resume-banner .btn {
  background: white;
  color: var(--accent);
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s;
}
.resume-banner .btn:hover {
  transform: translateY(-2px);
}
.resume-banner .btn.secondary {
  background: rgba(255,255,255,0.2);
  color: white;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.unfilled-question {
  border: 2px solid #ff9800 !important;
  animation: shake 0.5s;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}
`;

const styleSheet = document.createElement('style');
styleSheet.textContent = uxStyles;
document.head.appendChild(styleSheet);

// ===== 3. –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å localStorage =====

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è
function isDataExpired(timestamp) {
  if (!timestamp) return true;
  const now = Date.now();
  const expiryTime = EXPIRY_DAYS * 24 * 60 * 60 * 1000;
  return (now - timestamp) > expiryTime;
}

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
function saveAnswers() {
  try {
    const form = document.getElementById('quizForm');
    const formData = new FormData(form);
    const answers = {};
    
    for (let [key, value] of formData.entries()) {
      answers[key] = value;
    }
    
    localStorage.setItem(STORAGE_KEY, JSON.stringify(answers));
    localStorage.setItem(STORAGE_TIMESTAMP_KEY, Date.now().toString());
    localStorage.setItem(STORAGE_PROGRESS_KEY, currentIndex.toString());
    
    console.log('üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
  }
}

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
function loadAnswers() {
  try {
    const timestamp = localStorage.getItem(STORAGE_TIMESTAMP_KEY);
    if (isDataExpired(parseInt(timestamp))) {
      clearSavedData();
      return null;
    }
    
    const savedAnswers = localStorage.getItem(STORAGE_KEY);
    const savedProgress = localStorage.getItem(STORAGE_PROGRESS_KEY);
    
    if (savedAnswers) {
      return {
        answers: JSON.parse(savedAnswers),
        progress: parseInt(savedProgress) || 0
      };
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', error);
  }
  return null;
}

// –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
function clearSavedData() {
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem(STORAGE_PROGRESS_KEY);
  localStorage.removeItem(STORAGE_TIMESTAMP_KEY);
  console.log('üóëÔ∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function restoreAnswers(data) {
  const form = document.getElementById('quizForm');
  
  for (let [key, value] of Object.entries(data.answers)) {
    const input = form.elements[key];
    if (input) {
      if (input.type === 'radio') {
        const radio = form.querySelector(`input[name="${key}"][value="${value}"]`);
        if (radio) {
          radio.checked = true;
          // –í–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
          const label = radio.closest('.opt-card');
          if (label) label.classList.add('selected');
        }
      } else {
        input.value = value;
      }
    }
  }
  
  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
  if (typeof showQuestion === 'function') {
    showQuestion(data.progress);
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
  if (typeof updateProgress === 'function') {
    updateProgress();
  }
  
  showNotification('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!', 'success');
}

// ===== 4. –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–Ω–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è =====
function showResumeBanner() {
  const savedData = loadAnswers();
  if (!savedData) return;
  
  const banner = document.createElement('div');
  banner.className = 'resume-banner';
  banner.innerHTML = `
    <div class="message">
      üìå –£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å. –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
    </div>
    <div class="actions">
      <button class="btn" id="resumeTest">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      <button class="btn secondary" id="startFresh">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
  `;
  
  const mainCard = document.querySelector('main.card');
  mainCard.insertBefore(banner, mainCard.firstChild);
  
  document.getElementById('resumeTest').addEventListener('click', () => {
    restoreAnswers(savedData);
    banner.remove();
  });
  
  document.getElementById('startFresh').addEventListener('click', () => {
    clearSavedData();
    banner.remove();
    showNotification('–ù–∞—á–∏–Ω–∞–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞!', 'success');
  });
}

// ===== 5. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ =====
let autoSaveTimer;

function startAutoSave() {
  stopAutoSave(); // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
  autoSaveTimer = setInterval(() => {
    saveAnswers();
  }, AUTO_SAVE_INTERVAL);
}

function stopAutoSave() {
  if (autoSaveTimer) {
    clearInterval(autoSaveTimer);
  }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', (e) => {
  saveAnswers();
});

// ===== 6. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã =====
function validateForm() {
  const form = document.getElementById('quizForm');
  const formData = new FormData(form);
  const errors = [];
  const unfilledQuestions = [];
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è
  const demographics = ['population', 'education', 'field', 'religion_ident', 'gender', 'age'];
  demographics.forEach(field => {
    if (!formData.get(field)) {
      errors.push(`–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ: ${getDemographicLabel(field)}`);
    }
  });
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–ø—Ä–æ—Å—ã
  for (let i = 1; i <= questionsData.length; i++) {
    if (!formData.get(`q${i}`)) {
      unfilledQuestions.push(i);
    }
  }
  
  if (unfilledQuestions.length > 0) {
    errors.push(`–ù–µ –æ—Ç–≤–µ—á–µ–Ω–æ –Ω–∞ ${unfilledQuestions.length} –≤–æ–ø—Ä–æ—Å(–æ–≤): ${unfilledQuestions.slice(0, 5).join(', ')}${unfilledQuestions.length > 5 ? '...' : ''}`);
  }
  
  return {
    isValid: errors.length === 0,
    errors,
    unfilledQuestions
  };
}

function getDemographicLabel(fieldName) {
  const labels = {
    population: '–ù–∞—Å–µ–ª–µ–Ω–∏–µ',
    education: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
    field: '–û–±–ª–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã/—É—á–µ–±—ã',
    religion_ident: '–†–µ–ª–∏–≥–∏–æ–∑–Ω–∞—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å',
    gender: '–ü–æ–ª',
    age: '–í–æ–∑—Ä–∞—Å—Ç'
  };
  return labels[fieldName] || fieldName;
}

// –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
function highlightUnfilledQuestions(questionNumbers) {
  // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
  document.querySelectorAll('.unfilled-question').forEach(el => {
    el.classList.remove('unfilled-question');
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
  questionNumbers.forEach(num => {
    const questionCard = document.querySelector(`.question-card[data-index="${num-1}"]`);
    if (questionCard) {
      questionCard.classList.add('unfilled-question');
      setTimeout(() => questionCard.classList.remove('unfilled-question'), 2000);
    }
  });
}

// ===== 7. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è =====
function showConfirmModal(title, message, onConfirm, onCancel) {
  const modal = document.createElement('div');
  modal.className = 'confirm-modal show';
  modal.innerHTML = `
    <div class="confirm-content">
      <h3>${title}</h3>
      <p>${message}</p>
      <div class="confirm-buttons">
        <button class="btn" id="confirmCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn primary" id="confirmOk">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  document.getElementById('confirmOk').addEventListener('click', () => {
    modal.remove();
    if (onConfirm) onConfirm();
  });
  
  document.getElementById('confirmCancel').addEventListener('click', () => {
    modal.remove();
    if (onCancel) onCancel();
  });
  
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
      if (onCancel) onCancel();
    }
  });
}

// ===== 8. –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è =====
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideInRight 0.3s ease-out reverse';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// ===== 9. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–Ω–æ–ø–∫–æ–π "–ü–æ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç" =====
function enhancedCalculate() {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  const validation = validateForm();
  
  if (!validation.isValid) {
    showNotification('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã', 'warning');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
    setTimeout(() => {
      const errorList = validation.errors.slice(0, 3).join('\n');
      showConfirmModal(
        '–ï—Å—Ç—å –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è',
        `${errorList}\n\n–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º–∏.`,
        () => {
          // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
          calculate(); // –≤—ã–∑–æ–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
          clearSavedData(); // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        }
      );
    }, 500);
    
    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
    if (validation.unfilledQuestions.length > 0) {
      highlightUnfilledQuestions(validation.unfilledQuestions.slice(0, 5));
    }
    
    return;
  }
  
  // –ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ - —Å—á–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  calculate(); // –≤—ã–∑–æ–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
  clearSavedData(); // –û—á–∏—â–∞–µ–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  
  if (window.philosophyTestAnalytics) {
    window.philosophyTestAnalytics.trackTestComplete({
      philosophy: 'calculated',
      meaningIndex: 0
    });
  }
}

// ===== 10. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–Ω–æ–ø–∫–æ–π "–°–±—Ä–æ—Å–∏—Ç—å" =====
function enhancedReset() {
  showConfirmModal(
    '–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã?',
    '–í—Å–µ –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.',
    () => {
      document.getElementById('quizForm').reset();
      clearSavedData();
      
      // –û—á–∏—â–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
      document.querySelectorAll('.opt-card').forEach(c => c.classList.remove('selected'));
      document.querySelectorAll('.demo-card .opt-card').forEach(c => c.classList.remove('selected'));
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç
      const ageInput = document.querySelector('input[name="age"]');
      if (ageInput) ageInput.value = '';
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É –≤–æ–ø—Ä–æ—Å—É
      if (typeof showQuestion === 'function') {
        showQuestion(0);
      }
      
      if (typeof updateProgress === 'function') {
        updateProgress();
      }
      
      showNotification('üîÑ –¢–µ—Å—Ç —Å–±—Ä–æ—à–µ–Ω', 'success');
      
      if (window.philosophyTestAnalytics) {
        window.philosophyTestAnalytics.trackReset();
      }
    }
  );
}

// ===== 11. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã =====
function initProgressSystem() {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  showResumeBanner();
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  startAutoSave();
  
  // –ó–∞–º–µ–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  const calcBtn = document.getElementById('calcBtn');
  if (calcBtn) {
    calcBtn.removeEventListener('click', calculate);
    calcBtn.addEventListener('click', enhancedCalculate);
  }
  
  const resetBtn = document.getElementById('resetBtn');
  if (resetBtn) {
    resetBtn.removeEventListener('click', () => {});
    resetBtn.addEventListener('click', (e) => {
      e.preventDefault();
      enhancedReset();
    });
  }
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  const form = document.getElementById('quizForm');
  if (form) {
    form.addEventListener('change', () => {
      saveAnswers();
    });
  }
  
  console.log('üíæ –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
  console.log('‚úÖ UX —É–ª—É—á—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã');
}

// ===== 12. –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π =====
window.philosophyTestProgress = {
  saveAnswers,
  loadAnswers,
  clearSavedData,
  restoreAnswers,
  validateForm,
  showNotification,
  showConfirmModal,
  initProgressSystem
};

// –ê–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initProgressSystem);
} else {
  initProgressSystem();
}
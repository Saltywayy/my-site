<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Философский тест: Узнайте свое мировоззрение за 40 вопросов</title>
  <meta name="description" content="Пройдите бесплатный философский тест из 40 вопросов и узнайте свое мировоззрение: экзистенциализм, стоицизм, гедонизм и другие направления. Получите детальный анализ и индекс смыслоориентации." />
  <meta name="keywords" content="философский тест, тест на мировоззрение, экзистенциализм, стоицизм, философия онлайн, психологический тест, узнать свою философию" />
  <meta name="author" content="Философский тест" />
  
  <link rel="stylesheet" href="styles.css">
  
  <!-- jsPDF и pdfmake -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
</head>
<body data-theme="light">

  <header class="fixed-header" role="banner">
    <div class="header-inner">
      <div class="title">Философский тест — 40 вопросов</div>
      <div class="progress-wrap">
        <div class="progress"><div class="bar" id="globalProgressBar"></div></div>
        <div class="small" id="progressText">0 / 40</div>
      </div>
      <div class="controls">
        <button id="themeToggle" class="btn ghost" title="Переключить тему">Тема</button>
        <button id="openSummary" class="btn" title="Показать все ответы">Просмотр ответов</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <main class="card" role="main">
      <form id="quizForm" novalidate>
        <div id="demographicsArea"></div>
        <div id="questionsArea" style="margin-top:12px;"></div>

        <div class="nav-row">
          <div class="nav-left">
            <button type="button" id="prevBtn" class="btn" disabled>Назад</button>
            <button type="button" id="nextBtn" class="btn primary">Далее</button>
            <div class="small" id="qCounter">Вопрос 1 / 40</div>
          </div>
          <div class="nav-right">
            <button type="button" id="showAllBtn" class="btn">Показать все</button>
            <button type="button" id="calcBtn" class="btn primary">Посчитать результат</button>
            <button type="reset" id="resetBtn" class="btn">Сбросить</button>
          </div>
        </div>
      </form>

      <div id="result" aria-live="polite"></div>
    </main>
  </div>

  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" id="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3>Все ответы</h3>
        <div style="display:flex;gap:8px;">
          <button id="closeModal" class="btn">Закрыть</button>
        </div>
      </div>
      <div id="modalContent"></div>
    </div>
  </div>

  <!-- Скрытая форма для Netlify -->
  <form name="test-results" netlify netlify-honeypot="bot-field" hidden>
    <input type="text" name="philosophy" />
    <input type="text" name="subtype" />
    <input type="text" name="meaningIndex" />
    <input type="text" name="description" />
    <input type="text" name="age" />
    <input type="text" name="gender" />
    <input type="text" name="education" />
    <input type="text" name="population" />
    <input type="text" name="field" />
    <input type="text" name="religion_ident" />
    <input type="text" name="timestamp" />
    <input type="text" name="url" />
  </form>

  <!-- Согласие на обработку данных -->
  <div id="consentBackdrop" style="position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: flex; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(4px);">
    <div style="background: var(--card-bg,#fff); padding: 20px; border-radius: 14px; max-width: 420px; box-shadow: 0 8px 22px rgba(0,0,0,0.25);">
      <h2 style="margin-top:0">Согласие на обработку данных</h2>
      <p>Перед началом теста необходимо подтвердить согласие на обработку данных. Вся информация используется <b>исключительно в анонимном виде</b>.</p>
      <button id="consentAgree" style="margin-top:12px;width:100%;padding:10px;border-radius:8px;">Согласен</button>
    </div>
  </div>

  <!-- Подключение JS -->
  <script src="data.js"></script>

  <!-- Скрипт рендеринга демографии -->
  <script>
  function renderDemographics(demographicsData) {
    const container = document.getElementById('demographicsArea');
    container.innerHTML = '';

    demographicsData.forEach(field => {
      const wrapper = document.createElement('div');
      wrapper.className = 'demographic-field';
      wrapper.style.marginBottom = '12px';

      const label = document.createElement('label');
      label.textContent = field.label;
      wrapper.appendChild(label);

      if (field.opts === null) {
        const input = document.createElement('input');
        input.type = 'number';
        input.name = field.name;
        input.placeholder = 'Введите число';
        input.required = true;
        wrapper.appendChild(input);
      } else if (field.name === 'religion_ident') {
        const select = document.createElement('select');
        select.name = field.name;
        select.required = true;

        field.opts.forEach(opt => {
          const option = document.createElement('option');
          option.value = opt.value;
          option.textContent = opt.label;
          select.appendChild(option);
        });

        wrapper.appendChild(select);

        const customInput = document.createElement('input');
        customInput.type = 'text';
        customInput.name = 'custom_religion';
        customInput.placeholder = 'Укажите религию';
        customInput.style.display = 'none';
        customInput.style.marginTop = '4px';
        wrapper.appendChild(customInput);

        select.addEventListener('change', () => {
          customInput.style.display = select.value === 'custom' ? 'block' : 'none';
        });
      } else {
        const select = document.createElement('select');
        select.name = field.name;
        select.required = true;

        field.opts.forEach(opt => {
          const option = document.createElement('option');
          option.value = opt.value;
          option.textContent = opt.label;
          select.appendChild(option);
        });

        wrapper.appendChild(select);
      }

      container.appendChild(wrapper);
    });
  }

  renderDemographics(demographics);
  </script>

  <!-- Остальные JS файлы -->
  <script src="analytics.js"></script>
  <script src="export.js"></script>
  <script src="storage.js"></script>
  <script src="results-sender.js"></script>
  <script src="main.js"></script>

</body>
</html>
